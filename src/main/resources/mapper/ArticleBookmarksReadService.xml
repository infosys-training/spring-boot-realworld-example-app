<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="io.spring.infrastructure.mybatis.readservice.ArticleBookmarksReadService">
    <select id="isUserBookmark" resultType="java.lang.Boolean">
        select count(1) from article_bookmarks where user_id = #{userId} and article_id = #{articleId}
    </select>
    <select id="articleBookmarkCount" resultType="java.lang.Integer">
        select count(1) from article_bookmarks where article_id = #{articleId}
    </select>
    <select id="articlesBookmarkCount" resultMap="transfer.data.bookmarkCount">
        select A.id, count(AB.user_id) as bookmarkCount from articles A
        left join article_bookmarks AB on A.id = AB.article_id
        where id in
        <foreach collection="ids" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
        group by A.id
    </select>
    <select id="userBookmarks" resultType="java.lang.String">
        select
          A.id
        from articles A
        left join article_bookmarks AB on A.id = AB.article_id
        where id in
        <foreach collection="ids" item="item" separator="," open="(" close=")">
            #{item}
        </foreach>
        and AB.user_id = #{currentUser.id}
    </select>
</mapper>
